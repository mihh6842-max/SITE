<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ú–∞–≥–∞–∑–∏–Ω EXMO –∫–æ–¥–æ–≤</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Rubik:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <video autoplay muted loop playsinline class="video-background">
        <source src="19264a464315513c06c2dc242649e340.mp4" type="video/mp4">
    </video>

    <header>
        <div class="main-header">
            <div class="container">
                <div class="header-content">
                    <div class="logo">
                        <h1>EXMO –ú–ê–†–ö–ï–¢–ü–õ–ï–ô–°</h1>
                    </div>
                    <nav>
                        <a href="shop.html">–ú–∞–≥–∞–∑–∏–Ω</a>
                        <a href="#cart" onclick="toggleCart()">üõí –ö–æ—Ä–∑–∏–Ω–∞ (<span id="cartCount">0</span>)</a>
                    </nav>
                    <div class="user-menu">
                        <span class="user-email" id="userEmail">üë§ </span>
                        <a href="sell.html" class="btn-sell">–ü—Ä–æ–¥–∞—Ç—å</a>
                        <a href="#" onclick="logout()" class="btn-logout">–í—ã–π—Ç–∏</a>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <main>
        <section class="shop-section">
            <div class="container">
                <h2 class="main-title">–î–æ—Å—Ç—É–ø–Ω—ã–µ EXMO –∫–æ–¥—ã</h2>

                <div class="products-grid" id="productsGrid">
                    <!-- –¢–æ–≤–∞—Ä—ã –∑–∞–≥—Ä—É–∑—è—Ç—Å—è —á–µ—Ä–µ–∑ JS -->
                </div>
            </div>
        </section>
    </main>

    <aside class="cart-panel" id="cartPanel">
        <button class="close-auth" onclick="toggleCart()">‚úï</button>
        <h3>–ö–æ—Ä–∑–∏–Ω–∞</h3>
        <div id="cartItems"></div>
        <div class="cart-total">
            <strong>–ò—Ç–æ–≥–æ: <span id="cartTotal">0</span> ‚ÇΩ</strong>
        </div>
        <button class="btn-submit-auth" onclick="checkout()">–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑</button>
    </aside>

    <script src="shop.js"></script>
    <script>
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
        const currentUser = JSON.parse(sessionStorage.getItem('currentUser') || 'null');
        if (!currentUser) {
            window.location.href = 'login.html';
        }

        // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º email –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        document.getElementById('userEmail').textContent = 'üë§ ' + currentUser.email;

        // –°–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ —Ç–æ–≤–∞—Ä—ã –µ—Å–ª–∏ –∏—Ö –Ω–µ—Ç
        if (!localStorage.getItem('products') || JSON.parse(localStorage.getItem('products')).length === 0) {
            const testProducts = [
                {
                    id: 1,
                    sellerId: 1,
                    title: 'EXMO –∫–æ–¥ 5000‚ÇΩ',
                    description: '–ö–æ–¥ –±–∏—Ä–∂–∏ EXMO –Ω–∞ —Å—É–º–º—É 5000 —Ä—É–±–ª–µ–π. –ê–∫—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è –º–æ–º–µ–Ω—Ç–∞–ª—å–Ω–æ.',
                    exmoCode: 'EX-DEMO-5000-ABCD1234',
                    price: 5000,
                    paymentPhone: '+7 (900) 123-45-67',
                    paymentBank: '–°–±–µ—Ä–±–∞–Ω–∫',
                    status: 'active',
                    createdAt: new Date().toISOString()
                },
                {
                    id: 2,
                    sellerId: 1,
                    title: 'EXMO –∫–æ–¥ 10000‚ÇΩ',
                    description: '–ö–æ–¥ –±–∏—Ä–∂–∏ EXMO –Ω–∞ —Å—É–º–º—É 10000 —Ä—É–±–ª–µ–π. –ë—ã—Å—Ç—Ä—ã–π –≤—ã–≤–æ–¥ –±–µ–∑ –∫–æ–º–∏—Å—Å–∏–∏.',
                    exmoCode: 'EX-DEMO-10000-EFGH5678',
                    price: 10000,
                    paymentPhone: '+7 (900) 123-45-67',
                    paymentBank: '–¢–∏–Ω—å–∫–æ—Ñ—Ñ',
                    status: 'active',
                    createdAt: new Date().toISOString()
                },
                {
                    id: 3,
                    sellerId: 1,
                    title: 'EXMO –∫–æ–¥ 3000‚ÇΩ',
                    description: '–ü—Ä–æ–º–æ –∫–æ–¥ –Ω–∞ 3000 —Ä—É–±–ª–µ–π. –û—Ç–ª–∏—á–Ω–∞—è —Ü–µ–Ω–∞!',
                    exmoCode: 'EX-DEMO-3000-IJKL9012',
                    price: 3000,
                    paymentPhone: '+7 (900) 123-45-67',
                    paymentBank: '–í–¢–ë',
                    status: 'active',
                    createdAt: new Date().toISOString()
                }
            ];
            localStorage.setItem('products', JSON.stringify(testProducts));
        }

        // –í—ã—Ö–æ–¥
        function logout() {
            sessionStorage.removeItem('currentUser');
            window.location.href = 'login.html';
        }

        // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ç–æ–≤–∞—Ä—ã
        function loadProducts() {
            const products = JSON.parse(localStorage.getItem('products') || '[]');
            const productsGrid = document.getElementById('productsGrid');

            if (products.length === 0) {
                productsGrid.innerHTML = `
                    <div class="no-products">
                        <p>–ü–æ–∫–∞ –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤</p>
                        <a href="sell.html" class="btn-submit">–ü—Ä–æ–¥–∞—Ç—å –ø–µ—Ä–≤—ã–π –∫–ª—é—á</a>
                    </div>
                `;
                return;
            }

            // –§–∏–ª—å—Ç—Ä—É–µ–º —Ç–æ–ª—å–∫–æ –∞–∫—Ç–∏–≤–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã
            const activeProducts = products.filter(p => p.status === 'active');

            if (activeProducts.length === 0) {
                productsGrid.innerHTML = `
                    <div class="no-products">
                        <p>–í—Å–µ —Ç–æ–≤–∞—Ä—ã –ø—Ä–æ–¥–∞–Ω—ã</p>
                        <a href="sell.html" class="btn-submit">–î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä</a>
                    </div>
                `;
                return;
            }

            productsGrid.innerHTML = activeProducts.map(product => {
                const seller = JSON.parse(localStorage.getItem('users') || '[]').find(u => u.id === product.sellerId);
                const sellerPhone = seller ? seller.phone : '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ';

                return `
                    <div class="product-card">
                        <div class="product-header">
                            <h3>${product.title}</h3>
                            <span class="product-price">${Number(product.price).toLocaleString('ru-RU')} ‚ÇΩ</span>
                        </div>
                        <p class="product-description">${product.description || '–ë–µ–∑ –æ–ø–∏—Å–∞–Ω–∏—è'}</p>
                        <div class="product-info">
                            <small>–ü—Ä–æ–¥–∞–≤–µ—Ü: ${sellerPhone}</small>
                            <small>–î–æ–±–∞–≤–ª–µ–Ω–æ: ${new Date(product.createdAt).toLocaleString('ru-RU')}</small>
                        </div>
                        <button class="btn-add-cart" onclick="addToCart(${product.id}, '${product.title.replace(/'/g, "\\'")}', ${product.price})">
                            –î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É
                        </button>
                    </div>
                `;
            }).join('');
        }

        loadProducts();
    </script>
</body>
</html>
